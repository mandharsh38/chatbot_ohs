<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OHS Training AI</title>
    <style>
        /* -- palette -- */
        :root {
            --bg: #0b1b2a;
            /* header deep navy */
            --navy: #082033;
            /* darker navy for header */
            --bubble: #10233b;
            /* bot bubble dark */
            --user-bubble: #e8eef2;
            /* user bubble light */
            --accent: #6EE7B7;
            /* online green */
            --muted: #8892a6;
            --white: #ffffff;
            --card: #ffffff;
            --shadow: 0 10px 30px rgba(6, 10, 20, 0.35);
            --radius: 16px;
            --radius-sm: 10px;
        }

        /* Basic reset */
        * {
            box-sizing: border-box
        }

        body {
            font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial;
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(180deg, #f6fbff, #f2f6fa);
            color: #0f1724
        }

        /* Floating container */
        .chat-widget {
            position: fixed;
            right: 24px;
            bottom: 24px;
            width: 3800px;
            max-width: calc(100% - 48px);
            border-radius: 18px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transform-origin: bottom right;
            transition: transform .18s ease, right .18s ease, bottom .18s ease;
            z-index: 9999;
            height: 90%;
        }

        /* compact/minimized state */
        .chat-widget.minimized {
            height: 75px;
            width: 360px;
        }

        .chat-widget.minimized .chat-body {
            display: none
        }

        .chat-widget.minimized .chat-header {
            border-bottom-left-radius: 18px;
            border-bottom-right-radius: 18px;
        }

        /* expanded / full */
        .chat-widget.expanded {
            width: 90%;
            height: 90%;
            right: 36px;
            bottom: 36px;
            border-radius: 12px;
        }

        /* card look */
        .chat-card {
            background: var(--card);
            border-radius: inherit;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 58px;
        }

        /* header */
        .chat-header {
            background: linear-gradient(180deg, var(--navy), #062032);
            color: var(--white);
            padding: 14px 16px;
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
        }

        .bot-left {
            display: flex;
            gap: 12px;
            align-items: center;
            min-width: 0
        }

        .bot-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(180deg, #123, #234);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(2, 6, 12, 0.4)
        }

        .bot-meta {
            min-width: 0
        }

        .bot-title {
            font-size: 18px;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .bot-status {
            font-size: 12px;
            color: var(--accent);
            display: flex;
            gap: 8px;
            align-items: center
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 6px rgba(110, 231, 183, 0.4)
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            color: var(--white);
            cursor: pointer;
            transition: background .12s;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.09)
        }

        /* body area */
        .chat-body {
            background: linear-gradient(180deg, #fbfdff, #f3f6f9);
            display: flex;
            flex-direction: column;
            padding: 14px;
            gap: 12px;
            height: calc(100% - 66px);
            min-height: 360px;
        }

        /* message area (scroll) */
        .messages {
            flex: 1;
            overflow: auto;
            padding-right: 8px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        /* bubble styles */
        .msg-row {
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }

        .msg-row.bot {
            justify-content: flex-start;
        }

        .msg-row.user {
            justify-content: flex-end;
        }

        .bubble {
            max-width: 72%;
            padding: 14px 16px;
            border-radius: 14px;
            line-height: 1.35;
            box-shadow: 0 6px 18px rgba(6, 10, 20, 0.06);
            position: relative;
        }

        .bubble.bot {
            background: var(--bubble);
            color: var(--white);
            border-bottom-left-radius: 6px;
        }

        .bubble.user {
            background: var(--user-bubble);
            color: #111827;
            border-bottom-right-radius: 6px;
        }

        /* small timestamp / icons */
        .ts {
            font-size: 12px;
            color: var(--muted);
            margin-top: 6px;
            display: block;
            /* width: 10px; */
            margin-left: 5px;
        }

        .bot-avatar-small {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* input area */
        .chat-input {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border-top: 1px solid #edf2f7;
            background: transparent;
        }

        .input-box {
            flex: 1;
            display: flex;
            gap: 10px;
            align-items: center;
            background: #f5f8fb;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid #e6eef7;
        }

        .input-box input {
            border: 0;
            outline: none;
            background: transparent;
            font-size: 15px;
            flex: 1;
            color: #0b1220;
        }

        .quick-btn {
            background: #fff;
            border-radius: 10px;
            padding: 6px 10px;
            border: 1px solid #e8eef6;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            gap: 8px;
            align-items: center
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            border: none;
            background: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* little FAQ pill */
        .faq-pill {
            background: transparent;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid rgba(6, 10, 20, 0.04);
            font-size: 14px;
            color: #273849;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* responsive tweaks */
        @media (max-width:720px) {
            .chat-widget.expanded {
                width: 95vw;
                height: 86vh;
                right: 2.5vw;
                bottom: 6vh;
            }

            .chat-widget {
                right: 12px;
                bottom: 12px;
                width: 92vw;
            }
        }

        /* subtle appear animation */
        .chat-card {
            transform: translateY(6px);
            transition: transform .18s cubic-bezier(.2, .9, .2, 1), box-shadow .12s
        }

        .chat-card.open {
            transform: none
        }

        /* module styles */

        .modules-panel {
            display: none;
            flex-direction: column;
            gap: 12px;
            padding: 12px;
            background: #fdfefe;
            border-top: 1px solid #edf2f7;
            overflow-y: auto;
            max-height: 300px;
        }

        .module-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background .12s;
        }

        .module-card:hover {
            background: #f8fafc
        }

        .module-info {
            display: flex;
            flex-direction: column
        }

        .module-title {
            font-weight: 600;
            font-size: 15px
        }

        .module-status {
            font-size: 13px;
            color: #64748b
        }

        .module-action {
            font-size: 13px;
            color: #0b5cff;
            font-weight: 500
        }

        /* training styles */

        .training-block {
            background: #f1f5f9;
            padding: 12px 14px;
            margin: 10px 0;
            border-radius: 10px;
            font-size: 15px;
            line-height: 1.5;
        }

        .training-block img {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 8px;
        }

        .training-actions {
            margin-top: 12px;
            display: flex;
            justify-content: flex-end;
        }

        .btn-complete {
            background: #0b5cff;
            color: #fff;
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        /* test styles */
        .options-block {
            margin: 10px 0;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .option-btn {
            background: #fff;
            border: 1px solid #cbd5e1;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: background .15s;
        }

        .option-btn:hover {
            background: #f1f5f9
        }

        .score-box {
            margin: 12px 0;
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            font-size: 15px;
        }

        /* qa styles */
        .action-buttons {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #0b5cff;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <!-- Floating chat widget -->
    <div class="chat-widget minimized" id="chatWidget" aria-hidden="false">
        <div class="chat-card" id="chatCard">

            <!-- Header -->
            <div class="chat-header">
                <div class="bot-left">
                    <div class="bot-avatar" aria-hidden="true">
                        <svg width="76" height="76" viewBox="0 0 76 76" fill="none">
                            <circle cx="37.5" cy="37.5" r="37.5" fill="#FED555" />
                            <mask id="mask0_13_3" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                width="76" height="76">
                                <circle cx="37.6739" cy="37.6739" r="37.6319" fill="#FED555" />
                            </mask>
                            <g mask="url(#mask0_13_3)">
                                <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                    transform="matrix(-0.666195 -0.745778 0.746016 -0.665927 56.5292 45.9875)"
                                    fill="#FFF200" />
                                <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                    transform="matrix(-0.666195 -0.745778 0.746016 -0.665927 60.9584 42.0338)"
                                    fill="#FED555" />
                                <ellipse cx="2.9685" cy="2.96848" rx="2.9685" ry="2.96848"
                                    transform="matrix(-1.00013 0.00922206 -0.00920934 -0.99978 54.7185 28.2584)"
                                    fill="#FFF200" />
                                <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                    transform="matrix(0.666195 0.745778 -0.746016 0.665927 19.5392 30.0893)"
                                    fill="#52CD52" />
                                <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                    transform="matrix(0.666195 0.745778 -0.746016 0.665927 15.1102 34.043)"
                                    fill="#FED555" />
                                <ellipse cx="2.9685" cy="2.96848" rx="2.9685" ry="2.96848"
                                    transform="matrix(1.00013 -0.00922206 0.00920934 0.99978 21.3499 47.8183)"
                                    fill="#52CD52" />
                                <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                    transform="matrix(-0.746016 0.665927 -0.666194 -0.745778 45.3097 19.7647)"
                                    fill="#529BCD" />
                                <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                    transform="matrix(-0.746016 0.665927 -0.666194 -0.745778 41.3542 15.3371)"
                                    fill="#FED555" />
                                <ellipse cx="2.96848" cy="2.9685" rx="2.96848" ry="2.9685"
                                    transform="matrix(0.00920933 0.99978 -1.00013 0.00922206 27.574 21.5751)"
                                    fill="#52B4CD" />
                                <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                    transform="matrix(0.746016 -0.665927 0.666195 0.745778 30.5294 56.3786)"
                                    fill="#FF0206" />
                                <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                    transform="matrix(0.746016 -0.665927 0.666195 0.745778 34.4845 60.8061)"
                                    fill="#FED555" />
                                <ellipse cx="2.96848" cy="2.9685" rx="2.96848" ry="2.9685"
                                    transform="matrix(-0.00920934 -0.99978 1.00013 -0.00922206 48.265 54.5682)"
                                    fill="#FF0004" />
                            </g>
                        </svg>
                    </div>
                    <div class="bot-meta">
                        <div class="bot-title" id="botTitle">OHS Training AI</div>
                        <div class="bot-status"><span class="status-dot" aria-hidden="true"></span><span
                                style="font-size:12px;color:var(--accent);margin-left:6px">Online</span></div>
                    </div>
                </div>

                <div class="header-actions">
                    <!-- minimize / expand / enlarge -->
                    <button class="icon-btn" id="minimizeBtn" title="Minimize / Restore" aria-label="Minimize">
                        <!-- minus icon -->
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                            <path d="M6 12h12" stroke="white" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>

                    <button class="icon-btn" id="toggleSizeBtn" title="Toggle wide" aria-label="Toggle size">
                        <!-- maximize icon -->
                        <svg width="15" height="15" viewBox="0 0 24 24" fill="none">
                            <path d="M17.25 0H23M23 0V5.75M23 0L14.375 8.625M5.75 23H0M0 23V17.25M0 23L8.625 14.375"
                                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <!-- <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 8V4h4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 16v4h-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 4h-8v8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 20h8v-8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> -->
                    </button>

                    <button class="icon-btn" id="closeBtn" title="Close widget" aria-label="Close">
                        <!-- x icon -->
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                            <path d="M18 6L6 18" stroke="white" stroke-width="2" stroke-linecap="round" />
                            <path d="M6 6l12 12" stroke="white" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="chat-body" id="chatBody">

                <!-- messages area -->
                <div class="messages" id="messages">

                    <!-- sample user bubble -->
                    <div class="msg-row user">
                        <div style="margin-right: -90px;">
                            <div class="bubble user">What is the role of the ICC in a company?</div>
                            <span class="ts">7:20</span>
                        </div>
                        <div class="bot-avatar-small" aria-hidden="true" style="background:#ffffff;">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="6" r="4" />
                                    <path
                                        d="M20 17.5c0 2.485 0 4.5-8 4.5s-8-2.015-8-4.5S7.582 13 12 13s8 2.015 8 4.5Z" />
                                </g>
                            </svg>
                        </div>
                    </div>

                    <!-- sample bot bubble -->
                    <div class="msg-row bot">
                        <div class="bot-avatar-small" aria-hidden="true">
                            <svg width="76" height="76" viewBox="0 0 76 76" fill="none">
                                <circle cx="37.5" cy="37.5" r="37.5" fill="#FED555" />
                                <mask id="mask0_13_3" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                    width="76" height="76">
                                    <circle cx="37.6739" cy="37.6739" r="37.6319" fill="#FED555" />
                                </mask>
                                <g mask="url(#mask0_13_3)">
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(-0.666195 -0.745778 0.746016 -0.665927 56.5292 45.9875)"
                                        fill="#FFF200" />
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(-0.666195 -0.745778 0.746016 -0.665927 60.9584 42.0338)"
                                        fill="#FED555" />
                                    <ellipse cx="2.9685" cy="2.96848" rx="2.9685" ry="2.96848"
                                        transform="matrix(-1.00013 0.00922206 -0.00920934 -0.99978 54.7185 28.2584)"
                                        fill="#FFF200" />
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(0.666195 0.745778 -0.746016 0.665927 19.5392 30.0893)"
                                        fill="#52CD52" />
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(0.666195 0.745778 -0.746016 0.665927 15.1102 34.043)"
                                        fill="#FED555" />
                                    <ellipse cx="2.9685" cy="2.96848" rx="2.9685" ry="2.96848"
                                        transform="matrix(1.00013 -0.00922206 0.00920934 0.99978 21.3499 47.8183)"
                                        fill="#52CD52" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(-0.746016 0.665927 -0.666194 -0.745778 45.3097 19.7647)"
                                        fill="#529BCD" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(-0.746016 0.665927 -0.666194 -0.745778 41.3542 15.3371)"
                                        fill="#FED555" />
                                    <ellipse cx="2.96848" cy="2.9685" rx="2.96848" ry="2.9685"
                                        transform="matrix(0.00920933 0.99978 -1.00013 0.00922206 27.574 21.5751)"
                                        fill="#52B4CD" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(0.746016 -0.665927 0.666195 0.745778 30.5294 56.3786)"
                                        fill="#FF0206" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(0.746016 -0.665927 0.666195 0.745778 34.4845 60.8061)"
                                        fill="#FED555" />
                                    <ellipse cx="2.96848" cy="2.9685" rx="2.96848" ry="2.9685"
                                        transform="matrix(-0.00920934 -0.99978 1.00013 -0.00922206 48.265 54.5682)"
                                        fill="#FF0004" />
                                </g>
                            </svg>
                        </div>
                        <div>
                            <div class="bubble bot">
                                The Internal Complaints Committee (ICC) handles POSH complaints and ensures a fair
                                inquiry process.
                            </div>
                            <span class="ts">7:20</span>
                        </div>
                    </div>
                </div>

                <!-- modules area  -->
                <div class="modules-panel" id="modulesPanel"></div>

                <!-- input area -->
                <div class="chat-input" id="chatInput">
                    <div class="input-box" role="search" aria-label="Message input">
                        <button class="faq-pill" id="faqBtn" title="FAQs">
                            <!-- <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="flex-shrink:0">
                                <path d="M12 2a10 10 0 100 20 10 10 0 000-20z" fill="#eef2fb" />
                                <path
                                    d="M9.6 9.6c0-1.32 1.07-2.4 2.4-2.4.64 0 1.22.25 1.66.66.44.42.74 1 .74 1.74 0 .6-.25 1.04-.56 1.44-.29.38-.62.9-.62 1.7"
                                    stroke="#0b2b45" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" />
                            </svg> -->
                            ðŸ“š Modules
                        </button>

                        <input id="messageInput" type="text" placeholder="Type your message here..."
                            aria-label="Type your message here" />

                        <button class="send-btn" id="sendBtn" title="Send" aria-label="Send">
                            <!-- <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M22 2L15 22l-4-9-9-4 20-7z" stroke="white" stroke-width="1" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg> -->
                            <svg width="21" height="20" viewBox="0 0 21 20" fill="none">
                                <path
                                    d="M8.8947 3.52499L16.028 7.09166C19.228 8.69166 19.228 11.3083 16.028 12.9083L8.8947 16.475C4.0947 18.875 2.13637 16.9083 4.53637 12.1167L5.26137 10.675C5.4447 10.3083 5.4447 9.69999 5.26137 9.33332L4.53637 7.88332C2.13637 3.09166 4.10304 1.12499 8.8947 3.52499Z"
                                    stroke="#162550" stroke-width="2.01435" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M5.50293 10H10.0029" stroke="#162550" stroke-width="2.01435"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /*
          Step 1 widget behavior:
          - Minimize / restore (toggle)
          - Expand to wide view (toggle)
          - Close (hide) and reopen by clicking the small minimized bar (we'll provide a programmatic reopen below)
          - Basic sample messages are pre-rendered; message sending will append a user bubble and a dummy bot reply (placeholder for Step 5)
        */

        const widget = document.getElementById('chatWidget');
        const card = document.getElementById('chatCard');
        const minimizeBtn = document.getElementById('minimizeBtn');
        const toggleSizeBtn = document.getElementById('toggleSizeBtn');
        const closeBtn = document.getElementById('closeBtn');
        const messages = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const faqBtn = document.getElementById('faqBtn');

        // initial state
        let expanded = false;
        let minimized = true;

        // toggle minimize / restore
        function toggleMinimize() {
            minimized = !minimized;
            widget.classList.remove('expanded');
            widget.classList.toggle('minimized', minimized);
            card.classList.toggle('open', !minimized);
            if (!minimized) {
                // scroll to bottom when opening
                setTimeout(() => messages.scrollTop = messages.scrollHeight, 120);
                messageInput.focus();
            }
        }
        minimizeBtn.addEventListener('click', toggleMinimize);

        // toggle expanded wide
        toggleSizeBtn.addEventListener('click', () => {
            if (minimized) {
                card.classList.toggle('open', !minimized);
                minimized = false;
                widget.classList.remove('minimized');
                card.classList.add('open');
            } else {
                expanded = !expanded;
                widget.classList.toggle('expanded', expanded);
            }
            // when expanded, also remove minimized
            if (expanded) {
                minimized = false; widget.classList.remove('minimized');
                card.classList.add('open');
            }
        });

        // close button hides widget (you can provide a reopen button in your real app)
        closeBtn.addEventListener('click', () => {
            widget.style.display = 'none';
            // Add a small programmatic reopen after 1s for demo (in prod, you'll have a floating launcher)
            setTimeout(() => {
                widget.style.display = ''; // show again (demo). Remove this in production.
            }, 1000);
        });

        // message sending: append user bubble, then dummy bot reply
        function appendUserMessage(text) {
            const row = document.createElement('div'); row.className = 'msg-row user';
            const avatar = document.createElement('div'); avatar.className = 'bot-avatar-small'; avatar.style.background = 'linear-gradient(180deg,#fff,#fff)';
            // avatar.innerHTML = `<img src="https://via.placeholder.com/36" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover"/>`;
            avatar.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24">
                                <g fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="6" r="4" />
                                    <path
                                        d="M20 17.5c0 2.485 0 4.5-8 4.5s-8-2.015-8-4.5S7.582 13 12 13s8 2.015 8 4.5Z" />
                                </g>
                            </svg>`;
            const container = document.createElement('div');
            const bubble = document.createElement('div'); bubble.className = 'bubble user'; bubble.innerText = text;
            const ts = document.createElement('span'); ts.className = 'ts'; ts.innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            container.appendChild(bubble); container.appendChild(ts);
            row.appendChild(container); row.appendChild(avatar);
            messages.appendChild(row);
            messages.scrollTop = messages.scrollHeight;
        }

        function appendBotMessage(text) {
            const row = document.createElement('div'); row.className = 'msg-row bot';
            const avatar = document.createElement('div'); avatar.className = 'bot-avatar-small';
            avatar.innerHTML = `<svg width="76" height="76" viewBox="0 0 76 76" fill="none">
                                <circle cx="37.5" cy="37.5" r="37.5" fill="#FED555" />
                                <mask id="mask0_13_3" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                    width="76" height="76">
                                    <circle cx="37.6739" cy="37.6739" r="37.6319" fill="#FED555" />
                                </mask>
                                <g mask="url(#mask0_13_3)">
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(-0.666195 -0.745778 0.746016 -0.665927 56.5292 45.9875)"
                                        fill="#FFF200" />
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(-0.666195 -0.745778 0.746016 -0.665927 60.9584 42.0338)"
                                        fill="#FED555" />
                                    <ellipse cx="2.9685" cy="2.96848" rx="2.9685" ry="2.96848"
                                        transform="matrix(-1.00013 0.00922206 -0.00920934 -0.99978 54.7185 28.2584)"
                                        fill="#FFF200" />
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(0.666195 0.745778 -0.746016 0.665927 19.5392 30.0893)"
                                        fill="#52CD52" />
                                    <ellipse cx="18.7478" cy="18.7489" rx="18.7478" ry="18.7489"
                                        transform="matrix(0.666195 0.745778 -0.746016 0.665927 15.1102 34.043)"
                                        fill="#FED555" />
                                    <ellipse cx="2.9685" cy="2.96848" rx="2.9685" ry="2.96848"
                                        transform="matrix(1.00013 -0.00922206 0.00920934 0.99978 21.3499 47.8183)"
                                        fill="#52CD52" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(-0.746016 0.665927 -0.666194 -0.745778 45.3097 19.7647)"
                                        fill="#529BCD" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(-0.746016 0.665927 -0.666194 -0.745778 41.3542 15.3371)"
                                        fill="#FED555" />
                                    <ellipse cx="2.96848" cy="2.9685" rx="2.96848" ry="2.9685"
                                        transform="matrix(0.00920933 0.99978 -1.00013 0.00922206 27.574 21.5751)"
                                        fill="#52B4CD" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(0.746016 -0.665927 0.666195 0.745778 30.5294 56.3786)"
                                        fill="#FF0206" />
                                    <ellipse cx="18.7489" cy="18.7478" rx="18.7489" ry="18.7478"
                                        transform="matrix(0.746016 -0.665927 0.666195 0.745778 34.4845 60.8061)"
                                        fill="#FED555" />
                                    <ellipse cx="2.96848" cy="2.9685" rx="2.96848" ry="2.9685"
                                        transform="matrix(-0.00920934 -0.99978 1.00013 -0.00922206 48.265 54.5682)"
                                        fill="#FF0004" />
                                </g>
                            </svg>`;
            const container = document.createElement('div');
            const bubble = document.createElement('div'); bubble.className = 'bubble bot'; bubble.innerText = text;
            const ts = document.createElement('span'); ts.className = 'ts'; ts.innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            container.appendChild(bubble); container.appendChild(ts);
            row.appendChild(avatar); row.appendChild(container);
            messages.appendChild(row);
            messages.scrollTop = messages.scrollHeight;
        }

        // Send button handler (for now dummy behavior)
        sendBtn.addEventListener('click', () => {
            const txt = messageInput.value.trim();
            if (!txt) return;
            appendUserMessage(txt);
            messageInput.value = '';
            // simulate "thinking" then reply
            const loader = document.createElement('div'); loader.className = 'msg-row bot';
            loader.innerHTML = `<div class="bot-avatar-small" aria-hidden="true"><svg width="28" height="28" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#0b2b45"/></svg></div><div><div class="bubble bot">...</div></div>`;
            messages.appendChild(loader);
            messages.scrollTop = messages.scrollHeight;
            setTimeout(() => {
                loader.remove();
                appendBotMessage('(placeholder) Thanks â€” this is a dummy response');
            }, 750 + Math.random() * 600);
        });

        // press Enter to send
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendBtn.click();
            }
        });

        // FAQ button: show small quick replies
        faqBtn.addEventListener('click', () => {
            appendUserMessage('Show FAQs');
            setTimeout(() => {
                appendBotMessage('FAQs:\n 1) What is POSH training?\n  2) How often to retrain?\n  (This is demo content.)');
            }, 350);
        });

        /* Accessibility: allow focusing the widget with keyboard */
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // collapse if expanded, else minimize
                if (expanded) {
                    toggleSizeBtn.click();
                } else {
                    if (!minimized) minimizeBtn.click();
                }
            }
        });

        // modules panel 

        const modulesPanel = document.getElementById('modulesPanel');

        // Fake API call for demo
        async function fetchModules() {
            // In real life: const res = await fetch('/api/modules/');
            // return res.json();
            return [
                { id: 1, title: "POSH Training", status: "not_started" },
                { id: 2, title: "Python", status: "completed" },
                { id: 3, title: "Communication", status: "in_progress" }
            ];
        }

        // Render modules
        function renderModules(mods) {
            modulesPanel.innerHTML = '';
            mods.forEach(m => {
                const card = document.createElement('div');
                card.className = 'module-card';
                card.innerHTML = `
                        <div class="module-info">
                            <span class="module-title">${m.title}</span>
                            <span class="module-status">${statusLabel(m.status)}</span>
                        </div>
                        <div class="module-action">${actionLabel(m.status)}</div>
                        `;
                card.addEventListener('click', () => selectModule(m));
                modulesPanel.appendChild(card);
            });
        }

        // Status labels
        function statusLabel(s) {
            switch (s) {
                case 'not_started': return 'Not started';
                case 'in_progress': return 'In progress';
                case 'completed': return 'Completed';
                default: return s;
            }
        }
        function actionLabel(s) {
            if (s === 'not_started') return 'Start Training';
            if (s === 'in_progress') return 'Resume';
            if (s === 'completed') return 'Retake Test';
            return 'Open';
        }

        // When module chosen
        function selectModule(mod) {
            console.log(mod);
            appendUserMessage(`Selected: ${mod.title}`);
            currentModule = mod;
            qaMode = false;
            appendBotMessage(`Choose an option for <b>${mod.title}</b>:`);
            showModuleMenu(mod);
        }

        // Hook: FAQ button now shows module list instead
        faqBtn.removeEventListener('click', () => { });
        faqBtn.addEventListener('click', async () => {
            appendBotMessage('Fetching available modules...');
            const mods = await fetchModules();
            renderModules(mods);
            showModules();
        });

        let currentModule = null;

        // Fake API: training content
        async function fetchTrainingContent(moduleId) {
            // Replace with real API call: `/api/module/${moduleId}/content/`
            if (moduleId === 1) {
                return [
                    { type: 'text', value: "Welcome to POSH Training. This module will cover the basics of the POSH Act." },
                    { type: 'image', value: "https://cdn.britannica.com/47/246247-050-F1021DE9/AI-text-to-image-photo-robot-with-computer.jpg" },
                    { type: 'text', value: "The POSH Act mandates prevention and redressal of sexual harassment at the workplace." }
                ];
            }
            return [{ type: 'text', value: "Training content coming soon..." }];
        }

        // Render training inside chat
        async function startTraining(mod) {
            currentModule = mod;
            showMessages();
            appendBotMessage(`Starting training for <b>${mod.title}</b>...`);

            const content = await fetchTrainingContent(mod.id);
            for (const block of content) {
                if (block.type === 'text') {
                    appendBotMessage(block.value);
                } else if (block.type === 'image') {
                    const div = document.createElement('div');
                    div.className = 'training-block';
                    div.innerHTML = `<img src="${block.value}" alt="Training image"/>`;
                    messages.appendChild(div);
                }
            }

            // Add "Mark complete" button
            const actions = document.createElement('div');
            actions.className = 'training-actions';
            actions.innerHTML = `<button class="btn-complete">Mark Training Complete</button>`;
            actions.querySelector('button').addEventListener('click', () => completeTraining(mod.id));
            messages.appendChild(actions);
            messages.scrollTop = messages.scrollHeight;
        }

        // Complete training
        async function completeTraining(moduleId) {
            appendUserMessage("âœ… Training Completed");
            // Real API call:
            // await fetch(`/api/module/${moduleId}/complete_training/`,{method:'POST'});
            appendBotMessage("Great job! Training marked complete. You can now attempt the test anytime.");
            // Here we could set mod.status='completed' and refresh module list if needed
        }

        // Hook FAQ to module list
        faqBtn.addEventListener('click', async () => {
            appendBotMessage('Fetching available modules...');
            const mods = await fetchModules();
            renderModules(mods);
            showModules();
        });

        // test after training 

        let testState = null;

        // Fake API: start test
        async function startTest(moduleId) {
            // Replace with real API call: /api/module/${moduleId}/start_test/
            return [
                { id: 101, question: "What does POSH stand for?", options: ["Prevention of Social Harassment", "Prevention of Sexual Harassment", "Policy on Staff Harassment", "Protection of Staff & HR"], correct: "B" },
                { id: 102, question: "Which of these is sexual harassment?", options: ["Unwelcome physical contact", "Sexually colored remarks", "Demand for favors", "All of the above"], correct: "D" },
                { id: 103, question: "Who can file a complaint?", options: ["Only female employees", "Any aggrieved woman", "Only permanent staff", "Only contractual staff"], correct: "B" }
            ];
        }

        // Start test flow
        async function launchTest(mod) {
            appendBotMessage(`Starting test for <b>${mod.title}</b>.`);
            const questions = await startTest(mod.id);

            testState = {
                moduleId: mod.id,
                index: 0,
                questions: questions,
                answers: []
            };
            askNextQuestion();
        }

        // Ask next question
        function askNextQuestion() {
            if (!testState) return;
            if (testState.index >= testState.questions.length) {
                finishTest();
                return;
            }
            const q = testState.questions[testState.index];
            appendBotMessage(`<b>Q${testState.index + 1}:</b> ${q.question}`);

            const block = document.createElement('div');
            block.className = 'options-block';
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.addEventListener('click', () => selectAnswer(q, i));
                block.appendChild(btn);
            });
            messages.appendChild(block);
            messages.scrollTop = messages.scrollHeight;
        }

        // Handle answer
        function selectAnswer(q, choiceIndex) {
            const choiceLetter = ['A', 'B', 'C', 'D'][choiceIndex];
            appendUserMessage(`${choiceLetter}. ${q.options[choiceIndex]}`);

            testState.answers.push({
                questionId: q.id,
                selected: choiceLetter
            });

            testState.index++;
            askNextQuestion();
        }

        // Finish test
        async function finishTest() {
            appendBotMessage("Submitting your answers...");
            // Fake scoring
            let score = 0;
            testState.questions.forEach((q, i) => {
                const ans = testState.answers[i];
                if (ans && ans.selected === q.correct) score++;
            });
            const total = testState.questions.length;
            const percent = Math.round((score / total) * 100);
            const passed = percent >= 70;

            // Real API call: POST /api/module/${testState.moduleId}/submit_test/
            // with testState.answers

            const box = document.createElement('div');
            box.className = 'score-box';
            box.innerHTML = `Score: ${score}/${total} (${percent}%)<br>
                Result: ${passed ? "âœ… Passed" : "âŒ Failed"}`;
            messages.appendChild(box);
            messages.scrollTop = messages.scrollHeight;

            testState = null;
        }

        // qa mode 
        let qaMode = false;

        // Dummy Q&A API
        async function askQuestion(moduleId, text) {
            // Later â†’ real API: /api/module/${moduleId}/ask/
            return `ðŸ¤– (dummy) You asked: "${text}". I'll fetch proper answers later.`;
        }

        // Handle input send
        sendBtn.addEventListener('click', async () => {
            const text = msgInput.value.trim();
            if (!text) return;
            appendUserMessage(text);
            msgInput.value = '';

            if (qaMode && currentModule) {
                const reply = await askQuestion(currentModule.id, text);
                appendBotMessage(reply);
            } else {
                appendBotMessage("âš ï¸ Please select a module and an action first.");
            }
        });

        // Module action menu
        function showModuleMenu(mod) {
            showMessages();  

            const div = document.createElement('div');
            div.className = 'action-buttons';
            [
                { label: "ðŸ“– Training", action: () => startTraining(mod) },
                { label: "ðŸ“ Test", action: () => launchTest(mod) },
                { label: "ðŸ’¬ Questions", action: () => enterQAMode(mod) }
            ].forEach(btnData => {
                const btn = document.createElement('button');
                btn.className = 'action-btn';
                btn.innerText = btnData.label;
                btn.onclick = () => {
                    div.remove();
                    btnData.action();
                    // no need to call showMessages() here again
                };
                div.appendChild(btn);
            });

            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        // Switch views
        function showModules() {
            messages.style.display = 'none';
            modulesPanel.style.display = 'flex';
            document.getElementById('chatInput').style.display = 'none';
        }
        function showMessages() {
            messages.style.display = 'flex';
            modulesPanel.style.display = 'none';
            document.getElementById('chatInput').style.display = 'flex';
        }


        // Enter Q&A mode
        function enterQAMode(mod) {
            qaMode = true;
            appendBotMessage(`You can now ask me questions about <b>${mod.title}</b>.`);
        }

    </script>
</body>

</html>
